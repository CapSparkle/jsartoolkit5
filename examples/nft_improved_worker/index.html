<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>NFT_test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="../css/video-style.css" />
</head>


<body>

    <!-- Photo essentials -->
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.5/dist/html2canvas.min.js"></script>
    <script src="ua-parser.min.js"></script>
    <script src="FileSaver.js"></script>

    <script>
        function hasGetUserMedia() {
            return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
        }
        if (hasGetUserMedia()) {
            // Good to go!
        } else {
            alert("getUserMedia() is not supported by your browser");
        }
    </script>


    <script type="text/javascript">
        function alertF() {
            alert(1);
        }

        function TakeScreenshot() {
            alertF();
            let canvas = document.getElementById("canvas");
            html2canvas(canvas).then(
                function(canvas) {
                    console.log(typeof canvas);
                    canvas.toBlob(SaveScreenshoot());
                })
        }
    </script>


    <script type="text/javascript">
        var counter = 0;

        function SaveScreenshoot(blob) {
            var parser = new UAParser();
            var OS = parser.getOS().name;
            var browser = parser.getBrowser().name;
            OS = OS.toLowerCase();
            browser = browser.toLowerCase();
            console.log(OS);
            alert(OS + "|" + browser);

            counter += 1;
            saveAs(blob, "Photo_with_snowman_" + counter.toString());


            if (browser == "chrome") {
                chrome.desktopCapture.chooseDesktopMedia(['screen'], )
            }
        }
    </script>

    <button onclick="TakeScreenshot()" style="outline: none;">
    <img src="t2.png" style="
    position: absolute;
    z-index: 99999999;
    width: 5pc;
    height: 4pc;
    left: 50%;
    top: 100%;
    margin-left: -2.5pc;
    margin-top: -7.5pc;">
    </button>

    <!-- End button essentials -->

    <div id="loading">
        <img src="../Data/logo.gif" />
        <span class="loading-text">Loading, please wait</span>
    </div>

    <!--
  ==================
  STATS
  ==================
  -->

    <div id="stats" class="ui stats">
        <div id="stats1" class="stats-item">
            <p class="stats-item-title">
                Main
            </p>
        </div>

        <div id="stats2" class="stats-item">
            <p class="stats-item-title">
                Worker
            </p>
        </div>
    </div>

    <!--
      ==================
      CAMERA VIDEO & CANVAS
      ==================
      -->

    <div id="app">
        <video loop autoplay muted playsinline id="video"></video>

        <canvas id="canvas"></canvas>
    </div>

    <!--
      =====
      Hint about image
      =====

      <a
      href="https://raw.githubusercontent.com/artoolkit/artoolkit5/master/doc/Marker%20images/pinball.jpg"
      class="ui marker"
      target="_blank"
    >
      ðŸ–¼ Marker Image 
    </a>
    -->


    <script src="../js/third_party/three.js/stats.min.js"></script>
    <script src="../js/third_party/three.js/three.min.js"></script>
    <script src="../js/third_party/three.js/GLTFLoader.js"></script>

    <script src="threejs_worker_gltf.js"></script>

    <script>
        /**
         * STATS
         */
        var statsMain = new Stats();
        statsMain.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom
        document.getElementById("stats1").appendChild(statsMain.dom);

        var statsWorker = new Stats();
        statsWorker.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom
        document.getElementById("stats2").appendChild(statsWorker.dom);

        /**
         * APP / ELEMENTS
         */
        var container = document.getElementById("app");
        var video = document.getElementById("video");
        var canvas = document.getElementById("canvas");

        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            var hint = {
                audio: false,
                video: true
            };

            if (window.innerWidth < 800) {
                hint = {
                    audio: false,
                    video: {
                        width: {
                            ideal: 480
                        },
                        height: {
                            ideal: 640
                        },
                        facingMode: {
                            exact: "environment"
                        }
                    },
                };
            }

            navigator.mediaDevices.getUserMedia(hint).then(function(stream) {
                video.srcObject = stream;
                video.addEventListener("loadedmetadata", function() {
                    video.play();

                    start(
                        container,
                        markers["pinball"],
                        video,
                        video.videoWidth,
                        video.videoHeight,
                        canvas,
                        function() {
                            statsMain.update();
                        },
                        function() {
                            statsWorker.update();
                        },
                        null
                    );
                });
            });
        }
    </script>
</body>

</html>